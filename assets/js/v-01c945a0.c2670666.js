"use strict";(self.webpackChunkgithub_io_document=self.webpackChunkgithub_io_document||[]).push([[386],{9245:(s,n,a)=>{a.r(n),a.d(n,{data:()=>e});const e={key:"v-01c945a0",path:"/notes/002-acme-ssl-install.html",title:"安装ssl证书",lang:"zh-CN",frontmatter:{title:"安装ssl证书"},excerpt:"",headers:[{level:2,title:"配置",slug:"配置",children:[]},{level:2,title:"安装证书",slug:"安装证书",children:[]}],filePathRelative:"notes/002-acme-ssl-install.md",git:{updatedTime:1680856038e3,contributors:[{name:"CaoJiayuan",email:"cjy632258@hotmail.com",commits:1}]}}},9646:(s,n,a)=>{a.r(n),a.d(n,{default:()=>l});const e=(0,a(6252).uE)('<h1 id="安装-acme-sh" tabindex="-1"><a class="header-anchor" href="#安装-acme-sh" aria-hidden="true">#</a> 安装 acme.sh</h1><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">curl</span>  https://get.acme.sh <span class="token operator">|</span> <span class="token function">sh</span> -s <span class="token assign-left variable">email</span><span class="token operator">=</span>my@example.com\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h1 id="部署" tabindex="-1"><a class="header-anchor" href="#部署" aria-hidden="true">#</a> 部署</h1><h2 id="配置" tabindex="-1"><a class="header-anchor" href="#配置" aria-hidden="true">#</a> 配置</h2><blockquote><p>创建文件夹</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">mkdir</span> -p /var/www/le_root/.well-known/acme-challenge\n<span class="token function">chown</span> -R root:www-data /var/www/le_root\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p>创建引入文件 <code>/etc/nginx/includes/letsencrypt-webroot</code></p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># /etc/nginx/includes/letsencrypt-webroot</span>\n\nlocation /.well-known/acme-challenge/ <span class="token punctuation">{</span>\n    <span class="token builtin class-name">alias</span> /var/www/le_root/.well-known/acme-challenge/<span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p>引入配置文件</p></blockquote><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>\n    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>\n    <span class="token directive"><span class="token keyword">server_name</span> mydomain.com</span><span class="token punctuation">;</span>\n    <span class="token comment"># ...</span>\n    <span class="token directive"><span class="token keyword">include</span> includes/letsencrypt-webroot</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="highlight-lines"><br><br><br><br><div class="highlight-line"> </div><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><blockquote><p>重载nginx</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>systemctl reload nginx.service\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><h2 id="安装证书" tabindex="-1"><a class="header-anchor" href="#安装证书" aria-hidden="true">#</a> 安装证书</h2><blockquote><p>申请</p></blockquote><div class="language-hash ext-hash line-numbers-mode"><pre class="language-hash"><code>acme.sh --issue -d test.domain.com -w /var/www/le_root\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div><blockquote><p>安装</p></blockquote><div class="language-hash ext-hash line-numbers-mode"><pre class="language-hash"><code>mkdir -p /etc/nginx/certs/test.domain.com\nacme.sh --install-cert -d test.domain.com \\\n  --cert-file /etc/nginx/certs/test.domain.com/cert \\\n  --key-file /etc/nginx/certs/test.domain.com/key \\\n  --fullchain-file /etc/nginx/certs/test.domain.com/fullchain \\\n  --reloadcmd &quot;systemctl reload nginx.service&quot;\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><blockquote><p>配置</p></blockquote><div class="language-nginx ext-nginx line-numbers-mode"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span><span class="token punctuation">{</span>\n    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span>\n    <span class="token directive"><span class="token keyword">server_name</span> test.domain.com</span><span class="token punctuation">;</span>\n    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">443</span> ssl</span><span class="token punctuation">;</span>\n    <span class="token directive"><span class="token keyword">ssl_certificate</span>     certs/test.domain.com/cert</span><span class="token punctuation">;</span>\n    <span class="token directive"><span class="token keyword">ssl_certificate_key</span> certs/test.domain.com/key</span><span class="token punctuation">;</span>\n    <span class="token directive"><span class="token keyword">ssl_protocols</span>       TLSv1 TLSv1.1 TLSv1.2</span><span class="token punctuation">;</span>\n    <span class="token directive"><span class="token keyword">ssl_ciphers</span>         HIGH:!aNULL:!MD5</span><span class="token punctuation">;</span>\n    <span class="token directive"><span class="token keyword">ssl_prefer_server_ciphers</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span>\n    <span class="token directive"><span class="token keyword">ssl_session_cache</span> shared:SSL:10m</span><span class="token punctuation">;</span>\n    <span class="token directive"><span class="token keyword">ssl_session_timeout</span> <span class="token number">10m</span></span><span class="token punctuation">;</span>\n    <span class="token directive"><span class="token keyword">client_max_body_size</span> <span class="token number">10M</span></span><span class="token punctuation">;</span>\n    <span class="token comment"># ...</span>\n    <span class="token directive"><span class="token keyword">include</span> includes/letsencrypt-webroot</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="highlight-lines"><br><br><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><br><br><div class="highlight-line"> </div><br></div><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><blockquote><p>重载</p></blockquote><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>systemctl reload nginx.service\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br></div></div>',21),l={render:function(s,n){return e}}}}]);